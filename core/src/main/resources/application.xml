<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd
                           http://www.springframework.org/schema/context
                           http://www.springframework.org/schema/context/spring-context-4.3.xsd
                           http://www.springframework.org/schema/util
                           http://www.springframework.org/schema/util/spring-util-3.0.xsd">

    <import resource="classpath:stage.xml"/>
    <context:property-placeholder location="classpath:application.properties"/>

    <bean id="physicsSettings" class="com.astro.core.engine.physics.PhysicsSettings">
        <property name="gravity" value="${world.gravity}"/>
        <property name="groundX" value="${world.ground.x}"/>
        <property name="groundY" value="${world.ground.y}"/>
        <property name="groundWidth" value="${world.ground.width}"/>
        <property name="groundHeight" value="${world.ground.height}"/>
        <property name="groundDensity" value="${world.ground.density}"/>
        <property name="velocityIterations" value="${world.iteration.velocity}"/>
        <property name="positionIterations" value="${world.iteration.position}"/>
        <property name="timeStep" value="${world.time.step}"/>
        <property name="pixelPerMeter" value="${renderer.pixel.per.meter}"/>
        <property name="debugDraw" value="${renderer.debug}"/>
    </bean>

    <bean id="physicsEngine" class="com.astro.core.engine.physics.PhysicsEngine">
        <constructor-arg ref="physicsSettings"/>
    </bean>

    <!-- Loader of all scenes -->
    <bean id="overlapSceneReader" class="com.astro.core.overlap_runtime.OverlapSceneReader">
        <property name="physicsEngine" ref="physicsEngine"/>
    </bean>

    <!-- Factory of the all stages in game -->
    <bean id="stageFactory" class="com.astro.core.engine.stage.StageFactory">
        <property name="physicsEngine" ref="physicsEngine"/>
        <property name="overlapSceneReader" ref="overlapSceneReader"/>
    </bean>

    <!-- managing game screens  -->
    <bean id="gameLogic" class="com.astro.core.engine.base.GameLogic">
        <property name="stageFactory" ref="stageFactory"/>
        <property name="screenConfigs">
            <util:map id="screenConfigs">
                <entry key="MAIN_MENU" value-ref="mainMenuStageConfig"/>
                <entry key="SETTINGS" value-ref="settingsStageConfig"/>
                <entry key="HIGHSCORE" value-ref="highscoreStageConfig"/>
                <entry key="LEVEL1" value-ref="level1StageConfig"/>
                <entry key="GARAGE" value-ref="garageStageConfig"/>
            </util:map>
        </property>
    </bean>

    <!-- main loop of the game -->
    <bean id="gameEngine" lazy-init="true" class="com.astro.core.engine.base.GameEngine">
        <constructor-arg ref="gameLogic"/>
        <property name="timeStep" value="${world.time.step}"/>
        <property name="physicsEngine" ref="physicsEngine"/>
    </bean>

    <!-- player configuration -->
    <bean id="playerSettings" class="com.astro.core.script.player.PlayerSettings">
        <property name="maxYVelocity" value="${player.configuration.maxYVelocity}"/>
        <property name="maxYPosition" value="${player.configuration.maxYPosition}"/>
        <property name="playerHeight" value="${player.configuration.playerHeight}"/>
        <property name="inactivePLayerMessage" value="${player.configuration.inactivePLayerMessage}"/>
        <property name="inactiveMsgTime" value="${player.configuration.inactiveMsgTime}"/>
        <property name="interactWithObjectTime" value="${player.configuration.interactWithObjectTime}"/>
        <property name="pixelPerMeter" value="${renderer.pixel.per.meter}"/>
    </bean>

    <bean id="playerData" lazy-init="true" class="com.astro.core.script.player.PlayerData">
        <property name="settings" ref="playerSettings"/>
        <property name="cameraManager" ref="cameraManager"/>
    </bean>

    <bean id="box2DDebugRenderer" lazy-init="true" class="com.badlogic.gdx.physics.box2d.Box2DDebugRenderer"/>

    <!-- Game stage -->
    <bean id="gameStage" scope="prototype" class="com.astro.core.engine.stage.GameStage">
        <property name="physicsEngine" ref="physicsEngine"/>
        <property name="pixelPerMeter" value="${renderer.pixel.per.meter}"/>
        <property name="debugDraw" value="${renderer.debug}"/>
        <property name="scale" value="${renderer.scale}"/>
        <property name="renderer" ref="box2DDebugRenderer"/>
    </bean>

    <!-- camera manager -->
    <bean id="cameraManager" lazy-init="true" class="com.astro.core.engine.base.CameraManager">
        <property name="pixelPerMeter" value="${renderer.pixel.per.meter}"/>
        <property name="physicsEngine" ref="physicsEngine"/>
    </bean>

</beans>